<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
  <title>Bite Sushi House</title>

  <!-- Hard no-cache hints (best-effort; real headers should be set by the server) -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
  <meta http-equiv="Pragma" content="no-cache"/>
  <meta http-equiv="Expires" content="0"/>

  <meta name="theme-color" content="#0a0f1a" />
  <link rel="manifest" href="manifest.json" id="manifest-link" />

  <style>
    @import url("https://fonts.googleapis.com/css2?family=Urbanist:wght@300;400;500;600;700;800&display=swap");

    :root{ --bg:#0a0f1a; --txt:#fff; --muted:#9aa3b2; --accent:#00ff9b; --panel:#12182a; }
    *{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    html,body{ height:100%; }
    body{ margin:0; font-family:Urbanist,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif; background:#0a0f1a; color:var(--txt); overflow:hidden; }

    /* Main UI hidden when iframe shown */
    .container{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; padding:24px; }
    .card{ width:min(1024px,100%); background:linear-gradient(180deg,#0e1426,#121a31); border:1px solid #263252; border-radius:20px; padding:24px; box-shadow:0 10px 40px rgba(0,0,0,.35); }
    h1{ margin:0 0 16px; font-weight:800; letter-spacing:-.02em; }

    #grid{ display:grid; grid-template-columns:repeat(auto-fill,minmax(112px,1fr)); gap:12px; max-height:60vh; overflow:auto; }
    .tbtn{ padding:14px 12px; border-radius:12px; border:1px solid #2b3a5e; background:#18213a; color:#fff; font-weight:700; cursor:pointer; }

    /* Loader */
    #loader{ position:fixed; inset:0; background:#000; display:none; align-items:center; justify-content:center; z-index:10000; }
    #loader.show{ display:flex; }
    .spinner{ width:56px; height:56px; border:5px solid #2b3a5e; border-top-color:var(--accent); border-radius:50%; animation:spin 1s linear infinite; }
    @keyframes spin{to{ transform:rotate(360deg); }}

    /* Fullscreen iframe */
    #frame{ position:fixed; inset:0; width:100vw; height:100dvh; border:0; z-index:10001; background:#000; display:none; }
    #frame.show{ display:block; }

    /* Tiny debug bar to see what's going on on devices */
    #debug{ position:fixed; left:8px; right:8px; bottom:8px; background:#0f1322cc; color:#e6edf6; padding:10px 12px; border-radius:10px; border:1px solid #29324a; font-size:12px; z-index:10002; display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    #debug .dot{ width:8px; height:8px; border-radius:50%; background:#555; }
    #d-ev.load .dot{ background:#4ade80; }
    #d-watch.ok .dot{ background:#4ade80; }
    #d-watch.block .dot{ background:#f87171; }
    #d-cache .dot{ background:#60a5fa; }
    #debug button{ background:#192444; color:#dbe5ff; border:1px solid #2a3a63; border-radius:8px; padding:6px 10px; font-size:12px; cursor:pointer; }

    /* Toast */
    #toast{ position:fixed; left:50%; transform:translateX(-50%); bottom:72px; background:#0f1322; color:#e6edf6; padding:10px 14px; border-radius:10px; z-index:10003; border:1px solid #29324a; display:none; }
    #toast.show{ display:block; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Bite Sushi House</h1>
      <p style="color:var(--muted); margin-top:-6px;">Pick a table to open the menu fullscreen.</p>
      <div id="grid"></div>
    </div>
  </div>

  <iframe id="frame" allowfullscreen allow="fullscreen *; autoplay *; geolocation *; clipboard-read *; clipboard-write *"></iframe>
  <div id="loader"><div class="spinner"></div></div>
  <div id="toast"></div>

  <div id="debug">
    <div id="d-ev" title="iframe onload event"><span class="dot"></span>&nbsp;load</div>
    <div id="d-watch" title="paint/watchdog"><span class="dot"></span>&nbsp;watch</div>
    <div id="d-cache" title="cache-bust on"><span class="dot"></span>&nbsp;buster</div>
    <button id="btn-open-top">Open top-level</button>
    <button id="btn-clear-cache">Clear SW+Cache</button>
  </div>

  <script>
    (function(){
      const grid = document.getElementById('grid');
      const frame = document.getElementById('frame');
      const loader = document.getElementById('loader');
      const toast = document.getElementById('toast');
      const dEv = document.getElementById('d-ev');
      const dWatch = document.getElementById('d-watch');
      const dCache = document.getElementById('d-cache');
      const btnTop = document.getElementById('btn-open-top');
      const btnClear = document.getElementById('btn-clear-cache');

      const TABLES = [
        { "link": "https://bite.technology/menu/53/273", "name": " 01" }, { "link": "https://bite.technology/menu/53/274", "name": "01 B" }, { "link": "https://bite.technology/menu/53/275", "name": "01 C" }, { "link": "https://bite.technology/menu/53/276", "name": "01 F" }, { "link": "https://bite.technology/menu/53/277", "name": "01 G" }, { "link": "https://bite.technology/menu/53/278", "name": " 02 " }, { "link": "https://bite.technology/menu/53/279", "name": "02 B" }, { "link": "https://bite.technology/menu/53/280", "name": "02 C" }, { "link": "https://bite.technology/menu/53/281", "name": "02 F" }, { "link": "https://bite.technology/menu/53/282", "name": "02 G" }, { "link": "https://bite.technology/menu/53/283", "name": "02 H" }, { "link": "https://bite.technology/menu/53/284", "name": " 03" }, { "link": "https://bite.technology/menu/53/285", "name": "03 B" }, { "link": "https://bite.technology/menu/53/286", "name": "03 C" }, { "link": "https://bite.technology/menu/53/287", "name": "03 F" }, { "link": "https://bite.technology/menu/53/288", "name": " 05" }, { "link": "https://bite.technology/menu/53/289", "name": "05 B" }, { "link": "https://bite.technology/menu/53/290", "name": "05 C" }, { "link": "https://bite.technology/menu/53/291", "name": "05 F" }, { "link": "https://bite.technology/menu/53/292", "name": "05 G" }, { "link": "https://bite.technology/menu/53/293", "name": " 06" }, { "link": "https://bite.technology/menu/53/294", "name": "06 B" }, { "link": "https://bite.technology/menu/53/295", "name": "06 C" }, { "link": "https://bite.technology/menu/53/296", "name": "06 F" }, { "link": "https://bite.technology/menu/53/297", "name": "06 G" }, { "link": "https://bite.technology/menu/53/298", "name": " 07" }, { "link": "https://bite.technology/menu/53/299", "name": "07 B" }, { "link": "https://bite.technology/menu/53/300", "name": "07 C" }, { "link": "https://bite.technology/menu/53/301", "name": "07 F" }, { "link": "https://bite.technology/menu/53/302", "name": "07 G" }, { "link": "https://bite.technology/menu/53/303", "name": " 08" }, { "link": "https://bite.technology/menu/53/304", "name": "08 B" }, { "link": "https://bite.technology/menu/53/305", "name": "08 C" }, { "link": "https://bite.technology/menu/53/306", "name": "08 F" }, { "link": "https://bite.technology/menu/53/307", "name": "08 G" }, { "link": "https://bite.technology/menu/53/308", "name": " 09" }, { "link": "https://bite.technology/menu/53/309", "name": "09 B" }, { "link": "https://bite.technology/menu/53/310", "name": "09 C" }, { "link": "https://bite.technology/menu/53/311", "name": "09 F" }, { "link": "https://bite.technology/menu/53/312", "name": "09 G" }, { "link": "https://bite.technology/menu/53/313", "name": " 10" }, { "link": "https://bite.technology/menu/53/314", "name": "10 B" }, { "link": "https://bite.technology/menu/53/315", "name": "10 C" }, { "link": "https://bite.technology/menu/53/316", "name": "10 F" }, { "link": "https://bite.technology/menu/53/317", "name": " 11" }, { "link": "https://bite.technology/menu/53/318", "name": "11 B" }, { "link": "https://bite.technology/menu/53/319", "name": "11 C" }, { "link": "https://bite.technology/menu/53/320", "name": "11 F" }, { "link": "https://bite.technology/menu/53/321", "name": " 15" }, { "link": "https://bite.technology/menu/53/322", "name": "15 B" }, { "link": "https://bite.technology/menu/53/323", "name": "15 B" }, { "link": "https://bite.technology/menu/53/324", "name": "15 C" }, { "link": "https://bite.technology/menu/53/325", "name": "15 G" }, { "link": "https://bite.technology/menu/53/326", "name": " 16" }, { "link": "https://bite.technology/menu/53/327", "name": "16 B" }, { "link": "https://bite.technology/menu/53/328", "name": "16 C" }, { "link": "https://bite.technology/menu/53/329", "name": "16 G" }, { "link": "https://bite.technology/menu/53/330", "name": " 18" }, { "link": "https://bite.technology/menu/53/331", "name": " 19" }, { "link": "https://bite.technology/menu/53/332", "name": " 20" }, { "link": "https://bite.technology/menu/53/333", "name": " 20" }, { "link": "https://bite.technology/menu/53/334", "name": "20 B" }, { "link": "https://bite.technology/menu/53/335", "name": " 21" }, { "link": "https://bite.technology/menu/53/336", "name": "21 B" }, { "link": "https://bite.technology/menu/53/337", "name": " 22" }, { "link": "https://bite.technology/menu/53/338", "name": "22 B" }, { "link": "https://bite.technology/menu/53/339", "name": "22 C" }, { "link": "https://bite.technology/menu/53/340", "name": " 23" }, { "link": "https://bite.technology/menu/53/341", "name": "23 B" }, { "link": "https://bite.technology/menu/53/342", "name": "23 C" }, { "link": "https://bite.technology/menu/53/343", "name": " 25" }, { "link": "https://bite.technology/menu/53/344", "name": "25 B" }, { "link": "https://bite.technology/menu/53/345", "name": " 26" }, { "link": "https://bite.technology/menu/53/346", "name": "26 B" }, { "link": "https://bite.technology/menu/53/347", "name": " 31" }, { "link": "https://bite.technology/menu/53/348", "name": "31 B" }, { "link": "https://bite.technology/menu/53/349", "name": "31 C" }, { "link": "https://bite.technology/menu/53/350", "name": " 32" }, { "link": "https://bite.technology/menu/53/351", "name": "32 B" }, { "link": "https://bite.technology/menu/53/352", "name": "32 C" }, { "link": "https://bite.technology/menu/53/353", "name": " 33" }, { "link": "https://bite.technology/menu/53/354", "name": "33 B" }, { "link": "https://bite.technology/menu/53/355", "name": "33 C" }, { "link": "https://bite.technology/menu/53/356", "name": " 35" }, { "link": "https://bite.technology/menu/53/357", "name": "35 B" }, { "link": "https://bite.technology/menu/53/358", "name": "35 C" }, { "link": "https://bite.technology/menu/53/359", "name": " 36" }, { "link": "https://bite.technology/menu/53/360", "name": "36 B" }, { "link": "https://bite.technology/menu/53/361", "name": "36 C" }, { "link": "https://bite.technology/menu/53/362", "name": " 37" }, { "link": "https://bite.technology/menu/53/6462", "name": "37 B" }, { "link": "https://bite.technology/menu/53/6553", "name": "37 C" }, { "link": "https://bite.technology/menu/53/6645", "name": "38 " }, { "link": "https://bite.technology/menu/53/6738", "name": "38 B" }, { "link": "https://bite.technology/menu/53/6832", "name": "38 C" }, { "link": "https://bite.technology/menu/53/6927", "name": " 39" }, { "link": "https://bite.technology/menu/53/7023", "name": "39 B" }, { "link": "https://bite.technology/menu/53/7120", "name": " 40" }, { "link": "https://bite.technology/menu/53/7218", "name": "40 B" }, { "link": "https://bite.technology/menu/53/7317", "name": "40 C" }, { "link": "https://bite.technology/menu/53/7417", "name": " 41" }, { "link": "https://bite.technology/menu/53/7518", "name": "41 B" }, { "link": "https://bite.technology/menu/53/7620", "name": "41 C" }, { "link": "https://bite.technology/menu/53/7723", "name": " 42" }, { "link": "https://bite.technology/menu/53/7827", "name": "42 B" }, { "link": "https://bite.technology/menu/53/7932", "name": "42 C" }
      ];

      // ------- helpers
      const show = (el, on=true) => el.classList[on?'add':'remove']('show');
      const showToast = (msg) => { toast.textContent = msg; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'), 2800); };
      const cacheBust = (url) => {
        try{ const u = new URL(url, location.href); u.searchParams.set('_ts', String(Date.now())); dCache.classList.add('on'); return u.toString(); }catch{ dCache.classList.remove('on'); return url; }
      };

      let currentUrl = null; let watchdogTimer = null; let ultimateTimer = null;

      function openIFrame(url){
        dEv.classList.remove('load'); dWatch.classList.remove('ok','block');
        show(loader, true); frame.classList.remove('show');

        currentUrl = url;
        frame.removeAttribute('sandbox'); // sandbox can create blank screens on some Huawei webviews
        frame.src = cacheBust(url);

        frame.onload = () => {
          dEv.classList.add('load'); show(loader, false); frame.classList.add('show');
        };

        clearTimeout(watchdogTimer);
        watchdogTimer = setTimeout(() => {
          if (!frame.classList.contains('show')){
            dWatch.classList.add('block'); show(loader, false);
            showToast('Embedding blocked or slow. Opening full screen…');
            window.location.href = currentUrl; // guarantees visibility
          } else { dWatch.classList.add('ok'); }
        }, 1500);

        clearTimeout(ultimateTimer);
        ultimateTimer = setTimeout(() => {
          if (!frame.classList.contains('show')){ show(loader, false); window.location.href = currentUrl; }
        }, 6000);
      }

      // Build grid
      for (const t of TABLES){
        const b = document.createElement('button'); b.className = 'tbtn'; b.textContent = t.name.trim(); b.onclick = () => openIFrame(t.link); grid.appendChild(b);
      }

      // Buttons
      btnTop.onclick = () => { if (currentUrl) window.location.href = currentUrl; else showToast('Open a table first'); };
      btnClear.onclick = async () => {
        try{
          if ('serviceWorker' in navigator){ const regs = await navigator.serviceWorker.getRegistrations(); await Promise.all(regs.map(r => r.unregister())); }
          if (window.caches){ const names = await caches.keys(); await Promise.all(names.map(n => caches.delete(n))); }
          localStorage.clear(); sessionStorage.clear();
          showToast('Cache cleared. Reloading…'); setTimeout(()=>location.reload(true), 400);
        }catch(e){ console.warn(e); showToast('Could not clear all caches'); }
      };

      // Inline manifest (dev). Prefer a real file on prod.
      (function setupManifest(){
        const manifest = {
          name: 'Bite Sushi House', short_name: 'Bite',
          start_url: '/index.html?source=pwa', scope: '/',
          display: 'standalone', background_color: '#0a0f1a', theme_color: '#0a0f1a',
          icons: [
            { src: 'https://placehold.co/192x192/00ff9b/0a0f1a?text=Bite', sizes: '192x192', type: 'image/png', purpose:'any maskable' },
            { src: 'https://placehold.co/512x512/00ff9b/0a0f1a?text=Bite', sizes: '512x512', type: 'image/png', purpose:'any maskable' }
          ]
        };
        const url = 'data:application/manifest+json;base64,' + btoa(unescape(encodeURIComponent(JSON.stringify(manifest))));
        document.getElementById('manifest-link').setAttribute('href', url);
      })();

      // Minimal SW to satisfy installability (no caching at all)
      (function registerSW(){
        if (!('serviceWorker' in navigator)) return;
        const swCode = `self.addEventListener('install', e=>self.skipWaiting()); self.addEventListener('activate', e=>self.clients.claim());`;
        const blob = new Blob([swCode], { type:'text/javascript' });
        const swURL = URL.createObjectURL(blob);
        navigator.serviceWorker.register(swURL).catch(()=>{});
      })();

    })();
  </script>
</body>
</html>
